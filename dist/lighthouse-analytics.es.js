import{create as e}from"event-emitter-object";import t from"visibility-state-listener";import{validationkit as n,typekit as r,objectkit as i}from"basekits";var o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},a=Object.assign?Object.assign:function(e,t,n,r){for(var i=1;i<arguments.length;i++)p(Object(arguments[i]),(function(t,n){e[n]=t}));return e},u=function(){if(Object.create)return function(e,t,n,r){var i=f(arguments,1);return a.apply(this,[Object.create(e)].concat(i))};{function e(){}return function(t,n,r,i){var o=f(arguments,1);return e.prototype=t,a.apply(this,[new e].concat(o))}}}(),c=String.prototype.trim?function(e){return String.prototype.trim.call(e)}:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},s="undefined"!=typeof window?window:o,l={assign:a,create:u,trim:c,bind:function(e,t){return function(){return t.apply(e,Array.prototype.slice.call(arguments,0))}},slice:f,each:p,map:function(e,t){var n=g(e)?[]:{};return d(e,(function(e,r){return n[r]=t(e,r),!1})),n},pluck:d,isList:g,isFunction:function(e){return e&&"[object Function]"==={}.toString.call(e)},isObject:function(e){return e&&"[object Object]"==={}.toString.call(e)},Global:s};function f(e,t){return Array.prototype.slice.call(e,t||0)}function p(e,t){d(e,(function(e,n){return t(e,n),!1}))}function d(e,t){if(g(e)){for(var n=0;n<e.length;n++)if(t(e[n],n))return e[n]}else for(var r in e)if(e.hasOwnProperty(r)&&t(e[r],r))return e[r]}function g(e){return null!=e&&"function"!=typeof e&&"number"==typeof e.length}var m=l.slice,y=l.pluck,v=l.each,h=l.bind,w=l.create,b=l.isList,_=l.isFunction,j=l.isObject,E={createStore:I},S={version:"2.0.12",enabled:!1,get:function(e,t){var n=this.storage.read(this._namespacePrefix+e);return this._deserialize(n,t)},set:function(e,t){return void 0===t?this.remove(e):(this.storage.write(this._namespacePrefix+e,this._serialize(t)),t)},remove:function(e){this.storage.remove(this._namespacePrefix+e)},each:function(e){var t=this;this.storage.each((function(n,r){e.call(t,t._deserialize(n),(r||"").replace(t._namespaceRegexp,""))}))},clearAll:function(){this.storage.clearAll()},hasNamespace:function(e){return this._namespacePrefix=="__storejs_"+e+"_"},createStore:function(){return I.apply(this,arguments)},addPlugin:function(e){this._addPlugin(e)},namespace:function(e){return I(this.storage,this.plugins,e)}};function I(e,t,n){n||(n=""),e&&!b(e)&&(e=[e]),t&&!b(t)&&(t=[t]);var r=n?"__storejs_"+n+"_":"",i=n?new RegExp("^"+r):null;if(!/^[a-zA-Z0-9_\-]*$/.test(n))throw new Error("store.js namespaces can only have alphanumerics + underscores and dashes");var o=w({_namespacePrefix:r,_namespaceRegexp:i,_testStorage:function(e){try{var t="__storejs__test__";e.write(t,t);var n=e.read(t)===t;return e.remove(t),n}catch(e){return!1}},_assignPluginFnProp:function(e,t){var n=this[t];this[t]=function(){var t=m(arguments,0),r=this;function i(){if(n)return v(arguments,(function(e,n){t[n]=e})),n.apply(r,t)}var o=[i].concat(t);return e.apply(r,o)}},_serialize:function(e){return JSON.stringify(e)},_deserialize:function(e,t){if(!e)return t;var n="";try{n=JSON.parse(e)}catch(t){n=e}return void 0!==n?n:t},_addStorage:function(e){this.enabled||this._testStorage(e)&&(this.storage=e,this.enabled=!0)},_addPlugin:function(e){var t=this;if(b(e))v(e,(function(e){t._addPlugin(e)}));else if(!y(this.plugins,(function(t){return e===t}))){if(this.plugins.push(e),!_(e))throw new Error("Plugins must be function values that return objects");var n=e.call(this);if(!j(n))throw new Error("Plugins must return an object of function properties");v(n,(function(n,r){if(!_(n))throw new Error("Bad plugin property: "+r+" from plugin "+e.name+". Plugins should only return functions.");t._assignPluginFnProp(n,r)}))}},addStorage:function(e){!function(){var e="undefined"==typeof console?null:console;if(e){(e.warn?e.warn:e.log).apply(e,arguments)}}("store.addStorage(storage) is deprecated. Use createStore([storages])"),this._addStorage(e)}},S,{plugins:[]});return o.raw={},v(o,(function(e,t){_(e)&&(o.raw[t]=h(o,e))})),v(e,(function(e){o._addStorage(e)})),v(t,(function(e){o._addPlugin(e)})),o}var O=l.Global,P={name:"localStorage",read:T,write:function(e,t){return A().setItem(e,t)},each:function(e){for(var t=A().length-1;t>=0;t--){var n=A().key(t);e(T(n),n)}},remove:function(e){return A().removeItem(e)},clearAll:function(){return A().clear()}};function A(){return O.localStorage}function T(e){return A().getItem(e)}var N=l.Global,k={name:"sessionStorage",read:R,write:function(e,t){return x().setItem(e,t)},each:function(e){for(var t=x().length-1;t>=0;t--){var n=x().key(t);e(R(n),n)}},remove:function(e){return x().removeItem(e)},clearAll:function(){return x().clear()}};function x(){return N.sessionStorage}function R(e){return x().getItem(e)}var G=l.trim,D={name:"cookieStorage",read:function(e){if(!e||!B(e))return null;var t="(?:^|.*;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*";return unescape(q.cookie.replace(new RegExp(t),"$1"))},write:function(e,t){if(!e)return;q.cookie=escape(e)+"="+escape(t)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/"},each:F,remove:L,clearAll:function(){F((function(e,t){L(t)}))}},q=l.Global.document;function F(e){for(var t=q.cookie.split(/; ?/g),n=t.length-1;n>=0;n--)if(G(t[n])){var r=t[n].split("="),i=unescape(r[0]);e(unescape(r[1]),i)}}function L(e){e&&B(e)&&(q.cookie=escape(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")}function B(e){return new RegExp("(?:^|;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(q.cookie)}var C={name:"memoryStorage",read:function(e){return M[e]},write:function(e,t){M[e]=t},each:function(e){for(var t in M)M.hasOwnProperty(t)&&e(M[t],t)},remove:function(e){delete M[e]},clearAll:function(e){M={}}},M={};var z,V=E.createStore([P,k,D,C],[]),J=function(e,t){var n="000000000"+e;return n.substr(n.length-t)},U=J,$="object"==typeof window?window:self,H=Object.keys($).length,K=U(((navigator.mimeTypes?navigator.mimeTypes.length:0)+navigator.userAgent.length).toString(36)+H.toString(36),4),Y="undefined"!=typeof window&&(window.crypto||window.msCrypto)||"undefined"!=typeof self&&self.crypto;if(Y){var X=Math.pow(2,32)-1;z=function(){return Math.abs(Y.getRandomValues(new Uint32Array(1))[0]/X)}}else z=Math.random;var Z=function(){return K},W=J,Q=z,ee=0,te=Math.pow(36,4);function ne(){return W((Q()*te<<0).toString(36),4)}function re(){return ee=ee<te?ee:0,++ee-1}function ie(){return"c"+(new Date).getTime().toString(36)+W(re().toString(36),4)+Z()+(ne()+ne())}ie.slug=function(){var e=(new Date).getTime().toString(36),t=re().toString(36).slice(-4),n=Z().slice(0,1)+Z().slice(-1),r=ne().slice(-2);return e.slice(-2)+t+n+r},ie.isCuid=function(e){return"string"==typeof e&&!!e.startsWith("c")},ie.isSlug=function(e){if("string"!=typeof e)return!1;var t=e.length;return t>=7&&t<=10},ie.fingerprint=Z;var oe=ie;function ae(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};function i(){var e={},t=0,n=0;return{enqueue:function(t){e[n]=t,n++},dequeue:function(){var n=e[t];return delete e[t],t++,n},peek:function(){return e[t]},length:function(){return n-t}}}var o={trackVisibility:!0,collectReferrer:!0},a=Object.assign({},o,r),u=e();a.window||"undefined"==typeof window||window;var c=a.document||("undefined"==typeof document?void 0:document),s={storageKeys:{did:"LA_DID"}},l=[],f=i(),p={did:null,new:!1,user:{id:null},app:{name:null,version:null,id:null}};function d(){var e=V.get(s.storageKeys.did);n.isEmpty(e)&&(p.new=!0,e=oe(),V.set(s.storageKeys.did,e)),p.did=e,a.collectReferrer&&(p.referrer=c.referrer)}function g(e){e.hasOwnProperty("id")&&(p.user.id=e.id)}function m(e){Object.keys(p.app).map((function(t){e.hasOwnProperty(t)&&(p.app[t]=e[t])}))}function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Date.now(),i={name:e,timestamp:r,params:t};0===f.length()&&(i.firstVisitMaybe=p.new,a.collectReferrer&&(i.referrer=n.isNotEmpty(p.referrer)?p.referrer:null)),f.enqueue(i),l.length>0&&l.map((function(e){return e.send(f.dequeue(),p)})),u.emit("activity",[i,p])}function v(e){return l.push(e)&&e.init()}return d(),a.trackVisibility&&(p.currentVisibility="visible",t.on("update",(function(e){p.currentVisibility=e,u.emit("visibility",[e]),y("VISIBILITY",{value:e})})),t.start()),{on:u.on,newActivity:y,setUser:g,setApp:m,newService:v}}var ue=function(){var e=0,t=["bodyEnd","bodyStart","headEnd"];function n(e){return e.split("/").reverse()[0].split("?")[0]}function r(t){return t.replace(/[^a-zA-Z0-9]/g,"-").split("-").reverse().join("-")+"-"+e}return{create:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o={timeout:3e3};function a(i){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,u={id:null,type:"text/javascript",async:!0,attrs:{},location:t[0],global:null};return"[object Object]"===Object.prototype.toString.call(a)&&Object.keys(u).map((function(e){a.hasOwnProperty(e)&&(u[e]=a[e])})),u.id||(u.id=r(n(i)),e+=1),new Promise((function(e,t){if(document.getElementById(u.id))return e(u.id);var n=setTimeout((function(){return t(new Error("Inject timeout."))}),o.timeout),r=document.createElement("script");function a(){if(clearTimeout(n),!u.global)return e(u.id);var r=0,i=setInterval((function(){return r+=1,window[u.global]?(clearInterval(i),e(u.id)):r>=20?t(new Error("Max call size exceeded. Given up looking for global property.")):void 0}),100)}r.id=u.id,r.type=u.type,r.async=u.async,u.attrs&&Object.keys(u.attrs).map((function(e){r.setAttribute(e,u.attrs[e])})),r.addEventListener?r.addEventListener("load",a,!1):r.readyState?r.onreadystatechange=a:r.onload&&(r.onload=a),r.onerror&&(r.onerror=function(e){return clearTimeout(n),t(e)}),r.src=i,l(r,u.location)}))}function u(i){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,u={id:null,type:"text/css",media:"all",attrs:{},location:t[0]};return"[object Object]"===Object.prototype.toString.call(a)&&Object.keys(u).map((function(e){a.hasOwnProperty(e)&&(u[e]=a[e])})),u.id||(u.id=r(n(i)),e+=1),new Promise((function(e,t){if(document.getElementById(u.id))return e(u.id);var n=setTimeout((function(){return t(new Error("Inject timeout."))}),o.timeout),r=document.createElement("link");function a(){return r.media=u.media,clearTimeout(n),e(u.id)}r.id=u.id,r.rel="stylesheet",r.href=i,r.media="only x",u.attrs&&Object.keys(u.attrs).map((function(e){r.setAttribute(e,u.attrs[e])})),r.addEventListener?r.addEventListener("load",a,!1):r.readyState?r.onreadystatechange=a:r.onload&&(r.onload=a),r.onerror&&(r.onerror=function(e){return clearTimeout(n),t(e)}),l(r,u.location)}))}function c(n,r){var i={id:null,type:"application/ld+json",attrs:{},location:t[0]};if("[object Object]"===Object.prototype.toString.call(r)&&Object.keys(i).map((function(e){r.hasOwnProperty(e)&&(i[e]=r[e])})),i.id||(i.id=e,e+=1),document.getElementById(i.id))return i.id;var o=document.createElement("script");return o.id=i.id,o.type=i.type,o.text="string"==typeof n?n:JSON.stringify(n),i.attrs&&Object.keys(i.attrs).map((function(e){o.setAttribute(e,i.attrs[e])})),l(o,i.location),i.id}function s(e){var t=document.getElementById(e);t&&t.parentNode.removeChild(t)}function l(e,t){var n=document.getElementsByTagName("head")[0],r=document.getElementsByTagName("body")[0];"headEnd"==t?n.insertBefore(e,null):"bodyEnd"==t?r.insertBefore(e,null):"bodyStart"==t&&r.insertBefore(e,r.firstChild)}return"[object Object]"===Object.prototype.toString.call(i)&&Object.keys(o).map((function(e){i.hasOwnProperty(e)&&(o[e]=i[e])})),{injectjs:a,injectcss:u,injectjsonld:c,remove:s}}}}();function ce(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(r.isEmpty(e.property))throw new Error("Specify Google Analytics property.");var t=ue.create(),n={status:"NOT_INITIATED",queue:[]},o={name:"Google Analytics",property:e.property,userID:i.getProp(e,"userID",null),localEventNames:{SCREEN:"screen_view",TIMING:"timing_complete",EXCEPTION:"exception",SHARE:"share",SEARCH:"search",SIGNIN:"login",SIGNUP:"sign_up"}};function a(){n.status="INITIATING",window.dataLayer=window.dataLayer||[],window.gtag=function(){dataLayer.push(arguments)},window.gtag("js",new Date),window.gtag("config",o.property,{send_page_view:!1,user_id:o.userID});var e="https://www.googletagmanager.com/gtag/js?id="+o.property;return new Promise((function(r,i){t.injectjs(e,{id:"lighthouse-service-google-analytics",location:"headEnd"}).then((function(){return n.status="READY",c(),r()})).catch((function(e){return n.status="FAILED",i(e)}))}))}function u(e,t){return n.queue.push({activity:e,session:t})}function c(){n.queue.length>0&&(s(n.queue[0].activity,n.queue[0].session),n.queue.shift(),n.queue.length>0&&c())}function s(e,t){if("NOT_INITIATED"==n.status||"INITIATING"==n.status)return u(e,t);if("READY"==n.status){var r=i.getProp(o.localEventNames,e.name,e.name),a={};if("SCREEN"==e.name){var c={title:i.getProp(e.params,"title",document.title),page_location:i.getProp(e.params,"url",location.href),page_path:i.getProp(e.params,"path",location.pathname)};window.gtag("config",o.property,c),a.screen_name=i.getProp(e.params,"title",document.title),t.app.name&&(a.app_name=t.app.name),t.app.version&&(a.app_version=t.app.version)}else"EXCEPTION"==e.name?a.description=e.params.error.message:"SHARE"==e.name?(a.event_category=e.params.channel,a.event_label=i.getProp(e.params,"url",location.href)):"SEARCH"==e.name?(a.event_category="engagement",a.event_label=e.params.query):"SIGNIN"==e.name||"SIGNUP"==e.name?(a.event_category="engagement",a.event_label=e.params.method):(a.event_category="engagement",a.event_label=e.params.value||"");return window.gtag("event",r,a)}}function l(){window["ga-disable-"+o.property]=!0}function f(){window["ga-disable-"+o.property]=!1}return{name:o.name,init:a,send:s,disable:l,enable:f}}export{ce as GoogleAnalytics,ae as LighthouseAnalytics};
