"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("event-emitter-object"),t=require("visibility-state-listener"),n=require("basekits");function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=r(t),i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},a=function(e){return e&&e.Math==Math&&e},c=a("object"==typeof globalThis&&globalThis)||a("object"==typeof window&&window)||a("object"==typeof self&&self)||a("object"==typeof i&&i)||function(){return this}()||Function("return this")(),u={},s=function(e){try{return!!e()}catch(e){return!0}},l=!s((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),f={},p={}.propertyIsEnumerable,d=Object.getOwnPropertyDescriptor,g=d&&!p.call({1:2},1);f.f=g?function(e){var t=d(this,e);return!!t&&t.enumerable}:p;var y=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},m={}.toString,v=function(e){return m.call(e).slice(8,-1)},h=v,b="".split,w=s((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==h(e)?b.call(e,""):Object(e)}:Object,j=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},S=w,O=j,_=function(e){return S(O(e))},E=function(e){return"object"==typeof e?null!==e:"function"==typeof e},P=E,k=function(e,t){if(!P(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!P(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!P(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!P(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},I=j,A=function(e){return Object(I(e))},x=A,T={}.hasOwnProperty,N=function(e,t){return T.call(x(e),t)},M=E,F=c.document,G=M(F)&&M(F.createElement),L=function(e){return G?F.createElement(e):{}},R=!l&&!s((function(){return 7!=Object.defineProperty(L("div"),"a",{get:function(){return 7}}).a})),C=l,z=f,B=y,D=_,q=k,V=N,J=R,U=Object.getOwnPropertyDescriptor;u.f=C?U:function(e,t){if(e=D(e),t=q(t,!0),J)try{return U(e,t)}catch(e){}if(V(e,t))return B(!z.f.call(e,t),e[t])};var $={},H=E,K=function(e){if(!H(e))throw TypeError(String(e)+" is not an object");return e},W=l,X=R,Y=K,Z=k,Q=Object.defineProperty;$.f=W?Q:function(e,t,n){if(Y(e),t=Z(t,!0),Y(n),X)try{return Q(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var ee=$,te=y,ne=l?function(e,t,n){return ee.f(e,t,te(1,n))}:function(e,t,n){return e[t]=n,e},re={exports:{}},oe=c,ie=ne,ae=function(e,t){try{ie(oe,e,t)}catch(n){oe[e]=t}return t},ce=ae,ue=c["__core-js_shared__"]||ce("__core-js_shared__",{}),se=ue,le=Function.toString;"function"!=typeof se.inspectSource&&(se.inspectSource=function(e){return le.call(e)});var fe=se.inspectSource,pe=fe,de=c.WeakMap,ge="function"==typeof de&&/native code/.test(pe(de)),ye={exports:{}},me=ue;(ye.exports=function(e,t){return me[e]||(me[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.13.0",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"});var ve,he,be,we=0,je=Math.random(),Se=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++we+je).toString(36)},Oe=ye.exports,_e=Se,Ee=Oe("keys"),Pe={},ke=ge,Ie=E,Ae=ne,xe=N,Te=ue,Ne=function(e){return Ee[e]||(Ee[e]=_e(e))},Me=Pe,Fe=c.WeakMap;if(ke||Te.state){var Ge=Te.state||(Te.state=new Fe),Le=Ge.get,Re=Ge.has,Ce=Ge.set;ve=function(e,t){if(Re.call(Ge,e))throw new TypeError("Object already initialized");return t.facade=e,Ce.call(Ge,e,t),t},he=function(e){return Le.call(Ge,e)||{}},be=function(e){return Re.call(Ge,e)}}else{var ze=Ne("state");Me[ze]=!0,ve=function(e,t){if(xe(e,ze))throw new TypeError("Object already initialized");return t.facade=e,Ae(e,ze,t),t},he=function(e){return xe(e,ze)?e[ze]:{}},be=function(e){return xe(e,ze)}}var Be={set:ve,get:he,has:be,enforce:function(e){return be(e)?he(e):ve(e,{})},getterFor:function(e){return function(t){var n;if(!Ie(t)||(n=he(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},De=c,qe=ne,Ve=N,Je=ae,Ue=fe,$e=Be.get,He=Be.enforce,Ke=String(String).split("String");(re.exports=function(e,t,n,r){var o,i=!!r&&!!r.unsafe,a=!!r&&!!r.enumerable,c=!!r&&!!r.noTargetGet;"function"==typeof n&&("string"!=typeof t||Ve(n,"name")||qe(n,"name",t),(o=He(n)).source||(o.source=Ke.join("string"==typeof t?t:""))),e!==De?(i?!c&&e[t]&&(a=!0):delete e[t],a?e[t]=n:qe(e,t,n)):a?e[t]=n:Je(t,n)})(Function.prototype,"toString",(function(){return"function"==typeof this&&$e(this).source||Ue(this)}));var We=c,Xe=c,Ye=function(e){return"function"==typeof e?e:void 0},Ze=function(e,t){return arguments.length<2?Ye(We[e])||Ye(Xe[e]):We[e]&&We[e][t]||Xe[e]&&Xe[e][t]},Qe={},et=Math.ceil,tt=Math.floor,nt=function(e){return isNaN(e=+e)?0:(e>0?tt:et)(e)},rt=nt,ot=Math.min,it=function(e){return e>0?ot(rt(e),9007199254740991):0},at=nt,ct=Math.max,ut=Math.min,st=_,lt=it,ft=function(e,t){var n=at(e);return n<0?ct(n+t,0):ut(n,t)},pt=function(e){return function(t,n,r){var o,i=st(t),a=lt(i.length),c=ft(r,a);if(e&&n!=n){for(;a>c;)if((o=i[c++])!=o)return!0}else for(;a>c;c++)if((e||c in i)&&i[c]===n)return e||c||0;return!e&&-1}},dt={includes:pt(!0),indexOf:pt(!1)},gt=N,yt=_,mt=dt.indexOf,vt=Pe,ht=function(e,t){var n,r=yt(e),o=0,i=[];for(n in r)!gt(vt,n)&&gt(r,n)&&i.push(n);for(;t.length>o;)gt(r,n=t[o++])&&(~mt(i,n)||i.push(n));return i},bt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],wt=ht,jt=bt.concat("length","prototype");Qe.f=Object.getOwnPropertyNames||function(e){return wt(e,jt)};var St={};St.f=Object.getOwnPropertySymbols;var Ot=Qe,_t=St,Et=K,Pt=Ze("Reflect","ownKeys")||function(e){var t=Ot.f(Et(e)),n=_t.f;return n?t.concat(n(e)):t},kt=N,It=Pt,At=u,xt=$,Tt=s,Nt=/#|\.prototype\./,Mt=function(e,t){var n=Gt[Ft(e)];return n==Rt||n!=Lt&&("function"==typeof t?Tt(t):!!t)},Ft=Mt.normalize=function(e){return String(e).replace(Nt,".").toLowerCase()},Gt=Mt.data={},Lt=Mt.NATIVE="N",Rt=Mt.POLYFILL="P",Ct=Mt,zt=c,Bt=u.f,Dt=ne,qt=re.exports,Vt=ae,Jt=function(e,t){for(var n=It(t),r=xt.f,o=At.f,i=0;i<n.length;i++){var a=n[i];kt(e,a)||r(e,a,o(t,a))}},Ut=Ct,$t=function(e,t){var n,r,o,i,a,c=e.target,u=e.global,s=e.stat;if(n=u?zt:s?zt[c]||Vt(c,{}):(zt[c]||{}).prototype)for(r in t){if(i=t[r],o=e.noTargetGet?(a=Bt(n,r))&&a.value:n[r],!Ut(u?r:c+(s?".":"#")+r,e.forced)&&void 0!==o){if(typeof i==typeof o)continue;Jt(i,o)}(e.sham||o&&o.sham)&&Dt(i,"sham",!0),qt(n,r,i,e)}},Ht=ht,Kt=bt,Wt=Object.keys||function(e){return Ht(e,Kt)},Xt=l,Yt=s,Zt=Wt,Qt=St,en=f,tn=A,nn=w,rn=Object.assign,on=Object.defineProperty,an=!rn||Yt((function(){if(Xt&&1!==rn({b:1},rn(on({},"a",{enumerable:!0,get:function(){on(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=rn({},e)[n]||Zt(rn({},t)).join("")!=r}))?function(e,t){for(var n=tn(e),r=arguments.length,o=1,i=Qt.f,a=en.f;r>o;)for(var c,u=nn(arguments[o++]),s=i?Zt(u).concat(i(u)):Zt(u),l=s.length,f=0;l>f;)c=s[f++],Xt&&!a.call(u,c)||(n[c]=u[c]);return n}:rn;$t({target:"Object",stat:!0,forced:Object.assign!==an},{assign:an});var cn,un,sn=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},ln=v,fn=Array.isArray||function(e){return"Array"==ln(e)},pn=Ze("navigator","userAgent")||"",dn=c.process,gn=dn&&dn.versions,yn=gn&&gn.v8;yn?un=(cn=yn.split("."))[0]<4?1:cn[0]+cn[1]:pn&&(!(cn=pn.match(/Edge\/(\d+)/))||cn[1]>=74)&&(cn=pn.match(/Chrome\/(\d+)/))&&(un=cn[1]);var mn=un&&+un,vn=mn,hn=s,bn=!!Object.getOwnPropertySymbols&&!hn((function(){return!String(Symbol())||!Symbol.sham&&vn&&vn<41})),wn=bn&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,jn=c,Sn=ye.exports,On=N,_n=Se,En=bn,Pn=wn,kn=Sn("wks"),In=jn.Symbol,An=Pn?In:In&&In.withoutSetter||_n,xn=function(e){return On(kn,e)&&(En||"string"==typeof kn[e])||(En&&On(In,e)?kn[e]=In[e]:kn[e]=An("Symbol."+e)),kn[e]},Tn=E,Nn=fn,Mn=xn("species"),Fn=function(e,t,n){if(sn(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,o){return e.call(t,n,r,o)}}return function(){return e.apply(t,arguments)}},Gn=w,Ln=A,Rn=it,Cn=function(e,t){var n;return Nn(e)&&("function"!=typeof(n=e.constructor)||n!==Array&&!Nn(n.prototype)?Tn(n)&&null===(n=n[Mn])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===t?0:t)},zn=[].push,Bn=function(e){var t=1==e,n=2==e,r=3==e,o=4==e,i=6==e,a=7==e,c=5==e||i;return function(u,s,l,f){for(var p,d,g=Ln(u),y=Gn(g),m=Fn(s,l,3),v=Rn(y.length),h=0,b=f||Cn,w=t?b(u,v):n||a?b(u,0):void 0;v>h;h++)if((c||h in y)&&(d=m(p=y[h],h,g),e))if(t)w[h]=d;else if(d)switch(e){case 3:return!0;case 5:return p;case 6:return h;case 2:zn.call(w,p)}else switch(e){case 4:return!1;case 7:zn.call(w,p)}return i?-1:r||o?o:w}},Dn={forEach:Bn(0),map:Bn(1),filter:Bn(2),some:Bn(3),every:Bn(4),find:Bn(5),findIndex:Bn(6),filterOut:Bn(7)},qn=s,Vn=mn,Jn=xn("species"),Un=Dn.map;$t({target:"Array",proto:!0,forced:!function(e){return Vn>=51||!qn((function(){var t=[];return(t.constructor={})[Jn]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}("map")},{map:function(e){return Un(this,e,arguments.length>1?arguments[1]:void 0)}});var $n=A,Hn=Wt;$t({target:"Object",stat:!0,forced:s((function(){Hn(1)}))},{keys:function(e){return Hn($n(e))}});var Kn=Object.assign?Object.assign:function(e,t,n,r){for(var o=1;o<arguments.length;o++)er(Object(arguments[o]),(function(t,n){e[n]=t}));return e},Wn=function(){if(Object.create)return function(e,t,n,r){var o=Qn(arguments,1);return Kn.apply(this,[Object.create(e)].concat(o))};{function e(){}return function(t,n,r,o){var i=Qn(arguments,1);return e.prototype=t,Kn.apply(this,[new e].concat(i))}}}(),Xn=String.prototype.trim?function(e){return String.prototype.trim.call(e)}:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},Yn="undefined"!=typeof window?window:i,Zn={assign:Kn,create:Wn,trim:Xn,bind:function(e,t){return function(){return t.apply(e,Array.prototype.slice.call(arguments,0))}},slice:Qn,each:er,map:function(e,t){var n=nr(e)?[]:{};return tr(e,(function(e,r){return n[r]=t(e,r),!1})),n},pluck:tr,isList:nr,isFunction:function(e){return e&&"[object Function]"==={}.toString.call(e)},isObject:function(e){return e&&"[object Object]"==={}.toString.call(e)},Global:Yn};function Qn(e,t){return Array.prototype.slice.call(e,t||0)}function er(e,t){tr(e,(function(e,n){return t(e,n),!1}))}function tr(e,t){if(nr(e)){for(var n=0;n<e.length;n++)if(t(e[n],n))return e[n]}else for(var r in e)if(e.hasOwnProperty(r)&&t(e[r],r))return e[r]}function nr(e){return null!=e&&"function"!=typeof e&&"number"==typeof e.length}var rr=Zn.slice,or=Zn.pluck,ir=Zn.each,ar=Zn.bind,cr=Zn.create,ur=Zn.isList,sr=Zn.isFunction,lr=Zn.isObject,fr={createStore:dr},pr={version:"2.0.12",enabled:!1,get:function(e,t){var n=this.storage.read(this._namespacePrefix+e);return this._deserialize(n,t)},set:function(e,t){return void 0===t?this.remove(e):(this.storage.write(this._namespacePrefix+e,this._serialize(t)),t)},remove:function(e){this.storage.remove(this._namespacePrefix+e)},each:function(e){var t=this;this.storage.each((function(n,r){e.call(t,t._deserialize(n),(r||"").replace(t._namespaceRegexp,""))}))},clearAll:function(){this.storage.clearAll()},hasNamespace:function(e){return this._namespacePrefix=="__storejs_"+e+"_"},createStore:function(){return dr.apply(this,arguments)},addPlugin:function(e){this._addPlugin(e)},namespace:function(e){return dr(this.storage,this.plugins,e)}};function dr(e,t,n){n||(n=""),e&&!ur(e)&&(e=[e]),t&&!ur(t)&&(t=[t]);var r=n?"__storejs_"+n+"_":"",o=n?new RegExp("^"+r):null;if(!/^[a-zA-Z0-9_\-]*$/.test(n))throw new Error("store.js namespaces can only have alphanumerics + underscores and dashes");var i=cr({_namespacePrefix:r,_namespaceRegexp:o,_testStorage:function(e){try{var t="__storejs__test__";e.write(t,t);var n=e.read(t)===t;return e.remove(t),n}catch(e){return!1}},_assignPluginFnProp:function(e,t){var n=this[t];this[t]=function(){var t=rr(arguments,0),r=this;function o(){if(n)return ir(arguments,(function(e,n){t[n]=e})),n.apply(r,t)}var i=[o].concat(t);return e.apply(r,i)}},_serialize:function(e){return JSON.stringify(e)},_deserialize:function(e,t){if(!e)return t;var n="";try{n=JSON.parse(e)}catch(t){n=e}return void 0!==n?n:t},_addStorage:function(e){this.enabled||this._testStorage(e)&&(this.storage=e,this.enabled=!0)},_addPlugin:function(e){var t=this;if(ur(e))ir(e,(function(e){t._addPlugin(e)}));else if(!or(this.plugins,(function(t){return e===t}))){if(this.plugins.push(e),!sr(e))throw new Error("Plugins must be function values that return objects");var n=e.call(this);if(!lr(n))throw new Error("Plugins must return an object of function properties");ir(n,(function(n,r){if(!sr(n))throw new Error("Bad plugin property: "+r+" from plugin "+e.name+". Plugins should only return functions.");t._assignPluginFnProp(n,r)}))}},addStorage:function(e){!function(){var e="undefined"==typeof console?null:console;if(e){(e.warn?e.warn:e.log).apply(e,arguments)}}("store.addStorage(storage) is deprecated. Use createStore([storages])"),this._addStorage(e)}},pr,{plugins:[]});return i.raw={},ir(i,(function(e,t){sr(e)&&(i.raw[t]=ar(i,e))})),ir(e,(function(e){i._addStorage(e)})),ir(t,(function(e){i._addPlugin(e)})),i}var gr=Zn.Global,yr={name:"localStorage",read:vr,write:function(e,t){return mr().setItem(e,t)},each:function(e){for(var t=mr().length-1;t>=0;t--){var n=mr().key(t);e(vr(n),n)}},remove:function(e){return mr().removeItem(e)},clearAll:function(){return mr().clear()}};function mr(){return gr.localStorage}function vr(e){return mr().getItem(e)}var hr=Zn.Global,br={name:"sessionStorage",read:jr,write:function(e,t){return wr().setItem(e,t)},each:function(e){for(var t=wr().length-1;t>=0;t--){var n=wr().key(t);e(jr(n),n)}},remove:function(e){return wr().removeItem(e)},clearAll:function(){return wr().clear()}};function wr(){return hr.sessionStorage}function jr(e){return wr().getItem(e)}var Sr=Zn.trim,Or={name:"cookieStorage",read:function(e){if(!e||!kr(e))return null;var t="(?:^|.*;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*";return unescape(_r.cookie.replace(new RegExp(t),"$1"))},write:function(e,t){if(!e)return;_r.cookie=escape(e)+"="+escape(t)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/"},each:Er,remove:Pr,clearAll:function(){Er((function(e,t){Pr(t)}))}},_r=Zn.Global.document;function Er(e){for(var t=_r.cookie.split(/; ?/g),n=t.length-1;n>=0;n--)if(Sr(t[n])){var r=t[n].split("="),o=unescape(r[0]);e(unescape(r[1]),o)}}function Pr(e){e&&kr(e)&&(_r.cookie=escape(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")}function kr(e){return new RegExp("(?:^|;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(_r.cookie)}var Ir={name:"memoryStorage",read:function(e){return Ar[e]},write:function(e,t){Ar[e]=t},each:function(e){for(var t in Ar)Ar.hasOwnProperty(t)&&e(Ar[t],t)},remove:function(e){delete Ar[e]},clearAll:function(e){Ar={}}},Ar={};var xr,Tr=fr.createStore([yr,br,Or,Ir],[]),Nr=function(e,t){var n="000000000"+e;return n.substr(n.length-t)},Mr=Nr,Fr="object"==typeof window?window:self,Gr=Object.keys(Fr).length,Lr=Mr(((navigator.mimeTypes?navigator.mimeTypes.length:0)+navigator.userAgent.length).toString(36)+Gr.toString(36),4),Rr="undefined"!=typeof window&&(window.crypto||window.msCrypto)||"undefined"!=typeof self&&self.crypto;if(Rr){var Cr=Math.pow(2,32)-1;xr=function(){return Math.abs(Rr.getRandomValues(new Uint32Array(1))[0]/Cr)}}else xr=Math.random;var zr=function(){return Lr},Br=Nr,Dr=xr,qr=0,Vr=Math.pow(36,4);function Jr(){return Br((Dr()*Vr<<0).toString(36),4)}function Ur(){return qr=qr<Vr?qr:0,++qr-1}function $r(){return"c"+(new Date).getTime().toString(36)+Br(Ur().toString(36),4)+zr()+(Jr()+Jr())}$r.slug=function(){var e=(new Date).getTime().toString(36),t=Ur().toString(36).slice(-4),n=zr().slice(0,1)+zr().slice(-1),r=Jr().slice(-2);return e.slice(-2)+t+n+r},$r.isCuid=function(e){return"string"==typeof e&&!!e.startsWith("c")},$r.isSlug=function(e){if("string"!=typeof e)return!1;var t=e.length;return t>=7&&t<=10},$r.fingerprint=zr;var Hr=$r;var Kr=l,Wr=$.f,Xr=Function.prototype,Yr=Xr.toString,Zr=/^\s*function ([^ (]*)/;Kr&&!("name"in Xr)&&Wr(Xr,"name",{configurable:!0,get:function(){try{return Yr.call(this).match(Zr)[1]}catch(e){return""}}});var Qr=function(){var e=0,t=["bodyEnd","bodyStart","headEnd"];function n(e){return e.split("/").reverse()[0].split("?")[0]}function r(t){return t.replace(/[^a-zA-Z0-9]/g,"-").split("-").reverse().join("-")+"-"+e}return{create:function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i={timeout:3e3};function a(o){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,c={id:null,type:"text/javascript",async:!0,attrs:{},location:t[0],global:null};return"[object Object]"===Object.prototype.toString.call(a)&&Object.keys(c).map((function(e){a.hasOwnProperty(e)&&(c[e]=a[e])})),c.id||(c.id=r(n(o)),e+=1),new Promise((function(e,t){if(document.getElementById(c.id))return e(c.id);var n=setTimeout((function(){return t(new Error("Inject timeout."))}),i.timeout),r=document.createElement("script");function a(){if(clearTimeout(n),!c.global)return e(c.id);var r=0,o=setInterval((function(){return r+=1,window[c.global]?(clearInterval(o),e(c.id)):r>=20?t(new Error("Max call size exceeded. Given up looking for global property.")):void 0}),100)}r.id=c.id,r.type=c.type,r.async=c.async,c.attrs&&Object.keys(c.attrs).map((function(e){r.setAttribute(e,c.attrs[e])})),r.addEventListener?r.addEventListener("load",a,!1):r.readyState?r.onreadystatechange=a:r.onload&&(r.onload=a),r.onerror&&(r.onerror=function(e){return clearTimeout(n),t(e)}),r.src=o,l(r,c.location)}))}function c(o){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,c={id:null,type:"text/css",media:"all",attrs:{},location:t[0]};return"[object Object]"===Object.prototype.toString.call(a)&&Object.keys(c).map((function(e){a.hasOwnProperty(e)&&(c[e]=a[e])})),c.id||(c.id=r(n(o)),e+=1),new Promise((function(e,t){if(document.getElementById(c.id))return e(c.id);var n=setTimeout((function(){return t(new Error("Inject timeout."))}),i.timeout),r=document.createElement("link");function a(){return r.media=c.media,clearTimeout(n),e(c.id)}r.id=c.id,r.rel="stylesheet",r.href=o,r.media="only x",c.attrs&&Object.keys(c.attrs).map((function(e){r.setAttribute(e,c.attrs[e])})),r.addEventListener?r.addEventListener("load",a,!1):r.readyState?r.onreadystatechange=a:r.onload&&(r.onload=a),r.onerror&&(r.onerror=function(e){return clearTimeout(n),t(e)}),l(r,c.location)}))}function u(n,r){var o={id:null,type:"application/ld+json",attrs:{},location:t[0]};if("[object Object]"===Object.prototype.toString.call(r)&&Object.keys(o).map((function(e){r.hasOwnProperty(e)&&(o[e]=r[e])})),o.id||(o.id=e,e+=1),document.getElementById(o.id))return o.id;var i=document.createElement("script");return i.id=o.id,i.type=o.type,i.text="string"==typeof n?n:JSON.stringify(n),o.attrs&&Object.keys(o.attrs).map((function(e){i.setAttribute(e,o.attrs[e])})),l(i,o.location),o.id}function s(e){var t=document.getElementById(e);t&&t.parentNode.removeChild(t)}function l(e,t){var n=document.getElementsByTagName("head")[0],r=document.getElementsByTagName("body")[0];"headEnd"==t?n.insertBefore(e,null):"bodyEnd"==t?r.insertBefore(e,null):"bodyStart"==t&&r.insertBefore(e,r.firstChild)}return"[object Object]"===Object.prototype.toString.call(o)&&Object.keys(i).map((function(e){o.hasOwnProperty(e)&&(i[e]=o[e])})),{injectjs:a,injectcss:c,injectjsonld:u,remove:s}}}}();exports.GoogleAnalytics=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(n.typekit.isEmpty(e.property))throw new Error("Specify Google Analytics property.");var t=Qr.create(),r={name:"Google Analytics",property:e.property,userID:n.objectkit.getProp(e,"userID",null),localEventNames:{SCREEN:"screen_view",TIMING:"timing_complete",EXCEPTION:"exception",SHARE:"share",SEARCH:"search",SIGNIN:"login",SIGNUP:"sign_up"}};function o(){window.dataLayer=window.dataLayer||[],window.gtag=function(){dataLayer.push(arguments)},window.gtag("js",new Date),window.gtag("config",r.property,{send_page_view:!1,user_id:r.userID});var e="https://www.googletagmanager.com/gtag/js?id="+r.property;return t.injectjs(e,{id:"lighthouse-service-google-analytics",location:"headEnd"})}function i(e,t){var o=n.objectkit.getProp(r.localEventNames,e.name,e.name),i={};if("SCREEN"==e.name){var a={title:n.objectkit.getProp(e.params,"title",document.title),page_location:n.objectkit.getProp(e.params,"url",location.href),page_path:n.objectkit.getProp(e.params,"path",location.pathname)};window.gtag("config",r.property,a),i.screen_name=n.objectkit.getProp(e.params,"title",document.title),t.app.name&&(i.app_name=t.app.name),t.app.version&&(i.app_version=t.app.version)}else"EXCEPTION"==e.name?i.description=e.params.error.message:"SHARE"==e.name?(i.event_category=e.params.channel,i.event_label=n.objectkit.getProp(e.params,"url",location.href)):"SEARCH"==e.name?(i.event_category="engagement",i.event_label=e.params.query):"SIGNIN"==e.name||"SIGNUP"==e.name?(i.event_category="engagement",i.event_label=e.params.method):(i.event_category="engagement",i.event_label=e.params.value||"");window.gtag("event",o,i)}function a(){window["ga-disable-"+r.property]=!0}function c(){window["ga-disable-"+r.property]=!1}return{name:r.name,init:o,send:i,disable:a,enable:c}},exports.LighthouseAnalytics=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};function r(){var e={},t=0,n=0;return{enqueue:function(t){e[n]=t,n++},dequeue:function(){var n=e[t];return delete e[t],t++,n},peek:function(){return e[t]},length:function(){return n-t}}}var i={trackVisibility:!0,collectReferrer:!0},a=Object.assign({},i,t),c=e.create();a.window||"undefined"==typeof window||window;var u=a.document||("undefined"==typeof document?void 0:document),s={storageKeys:{did:"LA_DID"}},l=[],f=r(),p={did:null,new:!1,user:{id:null},app:{name:null,version:null,id:null}};function d(){var e=Tr.get(s.storageKeys.did);n.validationkit.isEmpty(e)&&(p.new=!0,e=Hr(),Tr.set(s.storageKeys.did,e)),p.did=e,a.collectReferrer&&(p.referrer=u.referrer)}function g(e){e.hasOwnProperty("id")&&(p.user.id=e.id)}function y(e){Object.keys(p.app).map((function(t){e.hasOwnProperty(t)&&(p.app[t]=e[t])}))}function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Date.now(),o={name:e,timestamp:r,params:t};0===f.length()&&(o.firstVisitMaybe=p.new,a.collectReferrer&&(o.referrer=n.validationkit.isNotEmpty(p.referrer)?p.referrer:null)),f.enqueue(o),l.length>0&&l.map((function(e){return e.send(f.dequeue(),p)})),c.emit("activity",[o,p])}function v(e){return l.push(e)&&e.init()}return d(),a.trackVisibility&&(p.currentVisibility="visible",o.default.on("update",(function(e){p.currentVisibility=e,c.emit("visibility",[e]),m("VISIBILITY",{value:e})})),o.default.start()),{on:c.on,newActivity:m,setUser:g,setApp:y,newService:v}};
